# Logrotate configuration for AI Playground
#
# Installation:
#   sudo cp docker/logging/logrotate.conf /etc/logrotate.d/aiplayground
#   sudo chmod 644 /etc/logrotate.d/aiplayground
#
# Test configuration:
#   sudo logrotate -d /etc/logrotate.d/aiplayground
#
# Force rotation:
#   sudo logrotate -f /etc/logrotate.d/aiplayground

# Application logs
/var/log/aiplayground/*.log {
    # Rotate daily
    daily

    # Keep 30 days of logs
    rotate 30

    # Don't error if log file is missing
    missingok

    # Don't rotate if log is empty
    notifempty

    # Compress rotated logs
    compress

    # Delay compression until next rotation
    delaycompress

    # Use date as suffix
    dateext
    dateformat -%Y%m%d

    # Create new log file with these permissions
    create 0644 www-data www-data

    # Shared scripts for all logs
    sharedscripts

    # Post-rotation script
    postrotate
        # Reload application if needed
        # docker-compose exec backend kill -HUP 1
    endscript
}

# Access logs (rotate more frequently)
/var/log/aiplayground/access.log {
    daily
    rotate 14
    missingok
    notifempty
    compress
    delaycompress
    dateext
    create 0644 www-data www-data
    sharedscripts
}

# Error logs (keep longer)
/var/log/aiplayground/error.log {
    daily
    rotate 90
    missingok
    notifempty
    compress
    delaycompress
    dateext
    create 0644 www-data www-data
    sharedscripts

    # Email on rotation if errors exist
    # mail admin@example.com

    postrotate
        # Optional: Send notification
        # echo "Error log rotated on $(date)" | mail -s "AI Playground Error Log Rotation" admin@example.com
    endscript
}

# Security logs (keep longest)
/var/log/aiplayground/security.log {
    daily
    rotate 180
    missingok
    notifempty
    compress
    delaycompress
    dateext
    create 0600 www-data www-data  # More restrictive permissions
    sharedscripts
}

# Performance logs
/var/log/aiplayground/performance.log {
    daily
    rotate 30
    missingok
    notifempty
    compress
    delaycompress
    dateext
    create 0644 www-data www-data
    sharedscripts
}

# Celery logs
/var/log/aiplayground/celery.log {
    daily
    rotate 14
    missingok
    notifempty
    compress
    delaycompress
    dateext
    create 0644 www-data www-data
    sharedscripts
}

# Preprocessing logs
/var/log/aiplayground/preprocessing.log {
    daily
    rotate 30
    missingok
    notifempty
    compress
    delaycompress
    dateext
    create 0644 www-data www-data
    sharedscripts
}
